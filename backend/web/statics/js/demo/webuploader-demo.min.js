jQuery(function(){function e(e){var a=o('<li id="'+e.id+'"><p class="title">'+e.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),s=o('<div class="file-panel"><span class="cancel">鍒犻櫎</span><span class="rotateRight">鍚戝彸鏃嬭浆</span><span class="rotateLeft">鍚戝乏鏃嬭浆</span></div>').appendTo(a),i=a.find("p.progress span"),t=a.find("p.imgWrap"),r=o('<p class="error"></p>'),d=function(e){switch(e){case"exceed_size":text="鏂囦欢澶у皬瓒呭嚭";break;case"interrupt":text="涓婁紶鏆傚仠";break;default:text="涓婁紶澶辫触锛岃閲嶈瘯"}r.text(text).appendTo(a)};"invalid"===e.getStatus()?d(e.statusText):(t.text("棰勮涓�"),n.makeThumb(e,function(e,a){if(e)return void t.text("涓嶈兘棰勮");var s=o('<img src="'+a+'">');t.empty().append(s)},v,b),w[e.id]=[e.size,0],e.rotation=0),e.on("statuschange",function(t,n){"progress"===n?i.hide().width(0):"queued"===n&&(a.off("mouseenter mouseleave"),s.remove()),"error"===t||"invalid"===t?(console.log(e.statusText),d(e.statusText),w[e.id][1]=1):"interrupt"===t?d("interrupt"):"queued"===t?w[e.id][1]=0:"progress"===t?(r.remove(),i.css("display","block")):"complete"===t&&a.append('<span class="success"></span>'),a.removeClass("state-"+n).addClass("state-"+t)}),a.on("mouseenter",function(){s.stop().animate({height:30})}),a.on("mouseleave",function(){s.stop().animate({height:0})}),s.on("click","span",function(){var a,s=o(this).index();switch(s){case 0:return void n.removeFile(e);case 1:e.rotation+=90;break;case 2:e.rotation-=90}x?(a="rotate("+e.rotation+"deg)",t.css({"-webkit-transform":a,"-mos-transform":a,"-o-transform":a,transform:a})):t.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(e.rotation/90%4+4)%4+")")}),a.appendTo(l)}function a(e){var a=o("#"+e.id);delete w[e.id],s(),a.off().find(".file-panel").off().end().remove()}function s(){var e,a=0,s=0,t=f.children();o.each(w,function(e,i){s+=i[0],a+=i[0]*i[1]}),e=s?a/s:0,t.eq(0).text(Math.round(100*e)+"%"),t.eq(1).css("width",Math.round(100*e)+"%"),i()}function i(){var e,a="";"ready"===k?a="閫変腑"+m+"寮犲浘鐗囷紝鍏�"+WebUploader.formatSize(h)+"銆�":"confirm"===k?(e=n.getStats(),e.uploadFailNum&&(a="宸叉垚鍔熶笂浼�"+e.successNum+"寮犵収鐗囪嚦XX鐩稿唽锛�"+e.uploadFailNum+'寮犵収鐗囦笂浼犲け璐ワ紝<a class="retry" href="#">閲嶆柊涓婁紶</a>澶辫触鍥剧墖鎴�<a class="ignore" href="#">蹇界暐</a>')):(e=n.getStats(),a="鍏�"+m+"寮狅紙"+WebUploader.formatSize(h)+"锛夛紝宸蹭笂浼�"+e.successNum+"寮�",e.uploadFailNum&&(a+="锛屽け璐�"+e.uploadFailNum+"寮�")),p.html(a)}function t(e){var a;if(e!==k){switch(c.removeClass("state-"+k),c.addClass("state-"+e),k=e){case"pedding":u.removeClass("element-invisible"),l.parent().removeClass("filled"),l.hide(),d.addClass("element-invisible"),n.refresh();break;case"ready":u.addClass("element-invisible"),o("#filePicker2").removeClass("element-invisible"),l.parent().addClass("filled"),l.show(),d.removeClass("element-invisible"),n.refresh();break;case"uploading":o("#filePicker2").addClass("element-invisible"),f.show(),c.text("鏆傚仠涓婁紶");break;case"paused":f.show(),c.text("缁х画涓婁紶");break;case"confirm":if(f.hide(),c.text("寮€濮嬩笂浼�").addClass("disabled"),a=n.getStats(),a.successNum&&!a.uploadFailNum)return void t("finish");break;case"finish":a=n.getStats(),a.successNum?alert("涓婁紶鎴愬姛"):(k="done",location.reload())}i()}}var n,o=jQuery,r=o("#uploader"),l=o('<ul class="filelist"></ul>').appendTo(r.find(".queueList")),d=r.find(".statusBar"),p=d.find(".info"),c=r.find(".uploadBtn"),u=r.find(".placeholder"),f=d.find(".progress").hide(),m=0,h=0,g=window.devicePixelRatio||1,v=110*g,b=110*g,k="pedding",w={},x=function(){var e=document.createElement("p").style,a="transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e;return e=null,a}();if(!WebUploader.Uploader.support())throw alert("Web Uploader 涓嶆敮鎸佹偍鐨勬祻瑙堝櫒锛佸鏋滀綘浣跨敤鐨勬槸IE娴忚鍣紝璇峰皾璇曞崌绾� flash 鎾斁鍣�"),new Error("WebUploader does not support the browser you are using.");n=WebUploader.create({pick:{id:"#filePicker",label:"鐐瑰嚮閫夋嫨鍥剧墖"},dnd:"#uploader .queueList",paste:document.body,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},swf:BASE_URL+"/Uploader.swf",disableGlobalDnd:!0,chunked:!0,server:"http://2betop.net/fileupload.php",fileNumLimit:300,fileSizeLimit:5242880,fileSingleSizeLimit:1048576}),n.addButton({id:"#filePicker2",label:"缁х画娣诲姞"}),n.onUploadProgress=function(e,a){var i=o("#"+e.id),t=i.find(".progress span");t.css("width",100*a+"%"),w[e.id][1]=a,s()},n.onFileQueued=function(a){m++,h+=a.size,1===m&&(u.addClass("element-invisible"),d.show()),e(a),t("ready"),s()},n.onFileDequeued=function(e){m--,h-=e.size,m||t("pedding"),a(e),s()},n.on("all",function(e){switch(e){case"uploadFinished":t("confirm");break;case"startUpload":t("uploading");break;case"stopUpload":t("paused")}}),n.onError=function(e){alert("Eroor: "+e)},c.on("click",function(){return o(this).hasClass("disabled")?!1:void("ready"===k?n.upload():"paused"===k?n.upload():"uploading"===k&&n.stop())}),p.on("click",".retry",function(){n.retry()}),p.on("click",".ignore",function(){alert("todo")}),c.addClass("state-"+k),s()});// JavaScript Document